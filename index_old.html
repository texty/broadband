<!DOCTYPE html>
<html>
<head>
    
    <title>Quick Start - Leaflet</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
    


    
</head>
<body>



<div id="mapid" style="width: 600px; height: 400px;"></div>

<script src="pixi.js"></script>
<script src="L.PixiOverlay.js"></script>
<script>

    var mymap = L.map('mapid').setView([51.505, -0.09], 13);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
            '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        id: 'mapbox.streets'
    }).addTo(mymap);

    var getJSON = function(url, successHandler, errorHandler) {
        var xhr = typeof XMLHttpRequest != 'undefined'
                ? new XMLHttpRequest()
                : new ActiveXObject('Microsoft.XMLHTTP');
        xhr.open('get', url, true);
        xhr.onreadystatechange = function() {
            var status;
            var data;
            if (xhr.readyState == 4) {
                status = xhr.status;
                if (status == 200) {
                    data = JSON.parse(xhr.responseText);
                    successHandler && successHandler(data);
                } else {
                    errorHandler && errorHandler(status);
                }
            }
        };
        xhr.send();
    };

    // L.marker([51.5, -0.09]).addTo(mymap)
    //     .bindPopup("<b>Hello world!</b><br />I am a popup.").openPopup();

    // L.circle([51.508, -0.11], 500, {
    //     color: 'red',
    //     fillColor: '#f03',
    //     fillOpacity: 0.5
    // }).addTo(mymap).bindPopup("I am a circle.");

    // L.polygon([
    //     [51.509, -0.08],
    //     [51.503, -0.06],
    //     [51.51, -0.047]
    // ]).addTo(mymap).bindPopup("I am a polygon.");


    // var popup = L.popup();

    // function onMapClick(e) {
    //     popup
    //         .setLatLng(e.latlng)
    //         .setContent("You clicked the map at " + e.latlng.toString())
    //         .openOn(mymap);
    // }

    // mymap.on('click', onMapClick);

    var pixiOverlay = L.pixiOverlay(function(utils) {
        // var polygonLatLngs2 = [
        //     [51.509, -0.08],
        //     [51.503, -0.06],
        //     [51.51, -0.047],
        //     [51.509, -0.08],
        //     [52.44, -0.35],
        //     [51.44, -0.11]
        // ];

        var polygonLatLngs = [
            [
              -0.14505386352539062,
              51.5230569329333
            ],
            [
              -0.1462554931640625,
              51.5257270458621
            ],
            [
              -0.14865875244140625,
              51.52796981972546
            ],
            [
              -0.1517486572265625,
              51.529144561945614
            ],
            [
              -0.15483856201171872,
              51.52967852566193
            ],
            [
              -0.16668319702148438,
              51.52487262675978
            ],
            [
              -0.16050338745117188,
              51.5185707907351
            ],
            [
              -0.15380859375,
              51.512588580360244
            ],
            [
              -0.15054702758789062,
              51.506285044481096
            ],
            [
              -0.14333724975585938,
              51.50158353472559
            ],
            [
              -0.13475418090820312,
              51.49859141231831
            ],
            [
              -0.12668609619140625,
              51.49752274956565
            ],
            [
              -0.08617401123046874,
              51.50799456412721
            ],
            [
              -0.08085250854492186,
              51.50820824957313
            ],
            [
              -0.07724761962890625,
              51.50884929989774
            ],
            [
              -0.07432937622070312,
              51.51045188624856
            ],
            [
              -0.07020950317382812,
              51.51397737779247
            ],
            [
              -0.06866455078125,
              51.518463972439385
            ],
            [
              -0.06299972534179688,
              51.5185707907351
            ],
            [
              -0.05733489990234376,
              51.53074643430678
            ],
            [
              -0.0460052490234375,
              51.54206472590799
            ],
            [
              -0.050983428955078125,
              51.54911054234792
            ],
            [
              -0.05458831787109375,
              51.55263304143232
            ],
            [
              -0.064544677734375,
              51.55167238691343
            ],
            [
              -0.0817108154296875,
              51.5563687272672
            ],
            [
              -0.08668899536132812,
              51.5563687272672
            ],
            [
              -0.092010498046875,
              51.556688914634506
            ],
            [
              -0.0968170166015625,
              51.55700909974777
            ],
            [
              -0.10471343994140624,
              51.556688914634506
            ],
            [
              -0.11106491088867188,
              51.555514883267996
            ],
            [
              -0.11569976806640624,
              51.55252630304316
            ],
            [
              -0.11724472045898438,
              51.547829565965294
            ],
            [
              -0.11758804321289061,
              51.54516074932728
            ],
            [
              -0.11758804321289061,
              51.541957962722606
            ],
            [
              -0.12170791625976562,
              51.536619484089776
            ],
            [
              -0.12531280517578122,
              51.53202789161459
            ],
            [
              -0.1297760009765625,
              51.52989210939491
            ],
            [
              -0.13269424438476562,
              51.52989210939491
            ],
            [
              -0.13612747192382812,
              51.53010569212588
            ],
            [
              -0.13853073120117188,
              51.530426064343594
            ],
            [
              -0.14230728149414062,
              51.530426064343594
            ],
            [
              -0.14385223388671875,
              51.52946494092692
            ],
            [
              -0.14505386352539062,
              51.52700864445432
            ],
            [
              -0.14505386352539062,
              51.5230569329333
            ]
          ];


        polygonLatLngs = polygonLatLngs.map(function(d) { return d.reverse() })

        //polygonLatLngs = [polygonLatLngs1, polygonLatLngs2];
        var projectedPolygon;
        var triangle = new PIXI.Graphics();

        var pixiContainer = new PIXI.Container();
        pixiContainer.addChild(triangle);
        

        var firstDraw = true;
        // var prevZoom;

        var pixiOverlay = L.pixiOverlay(function(utils) {
            var zoom = utils.getMap().getZoom();
            var container = utils.getContainer();
            var renderer = utils.getRenderer();
            var project = utils.latLngToLayerPoint;
            var scale = utils.getScale();


            if (firstDraw) {
                projectedPolygon = polygonLatLngs.map(function(coords) {return project(coords);});
            }
            if (firstDraw || prevZoom !== zoom) {
                triangle.clear();
                triangle.lineStyle(3 / scale, 0x3388ff, 1);
                triangle.beginFill(0x3388ff, 0.2);
                projectedPolygon.forEach(function(coords, index) {
                    if (index == 0) triangle.moveTo(coords.x, coords.y);
                    else triangle.lineTo(coords.x, coords.y);
                });
                triangle.endFill();
            }
            // firstDraw = false;
            // prevZoom = zoom;
            renderer.render(container);
        }, pixiContainer);
        pixiOverlay.addTo(mymap);
    }, new PIXI.Container());

    pixiOverlay.addTo(mymap);

    

</script>



</body>
</html>
